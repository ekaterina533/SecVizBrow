<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{% block title %}SecVizBrowser{% endblock %}</title>
  <link rel="icon" href="{{ url_for('static', filename='images/logo.svg') }}" type="image/svg+xml" />

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}" />

  {% block head %}{% endblock %}
</head>

<body>
  <!-- Скрытая кнопка входа -->
  <button id="secret-login-btn" class="btn btn-outline-primary position-fixed" style="top: 20px; right: 20px; display: none; z-index: 9999;">
    Войти
  </button>

  <!-- Навбар -->
  <nav class="navbar navbar-light bg-white border-bottom py-2">
    <div class="container-fluid d-flex justify-content-between align-items-center flex-wrap">
        
        <!-- Логотип -->
        <a class="navbar-brand d-flex align-items-center gap-2 ms-3" href="{{ url_for('main.index') }}">
        <img src="{{ url_for('static', filename='images/logo.svg') }}" alt="Logo" height="48" />
        <span class="fw-bold fs-4">
            <span style="color:#dc3545">Sec</span><span style="color:#6c757d">Viz</span><span style="color:#212529">Browser</span>
        </span>
        </a>

        <!-- Кнопки авторизации -->
        <div class="d-flex flex-column flex-sm-row gap-2" id="auth-buttons">
            {% if current_user.is_authenticated %}
                {% if current_user.is_admin %}
                    <a class="btn btn-outline-dark" href="{{ url_for('admin.admin_panel') }}">Админ-панель</a>
                {% endif %}
                <a class="btn btn-outline-danger" href="{{ url_for('auth.logout') }}">Выйти</a>
            {% endif %}
        </div>
    </div>
  </nav>

  <!-- Контент -->
  <div class="container-fluid">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show mt-3" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Закрыть"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    {% block content %}{% endblock %}
  </div>

  {% if request.endpoint != 'auth.login' %}
    <!-- Футер -->
    <footer class="text-center mt-5 border-top pt-3">
      <div class="container">
        <p class="footer-text mb-0">
          © {{ current_year }} SecVizBrowser. Все права защищены.
          &nbsp;|&nbsp;
          <a href="https://github.com/yourusername/secvizbrowser" target="_blank">GitHub проекта</a>
        </p>
      </div>
    </footer>
  {% endif %}

  <!-- Scroll-to-top button -->
  <button type="button" id="scrollTopBtn" class="btn btn-primary rounded-circle shadow">
    <i class="bi bi-arrow-up"></i>
  </button>

  <!-- Bootstrap Bundle JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Scroll to top script -->
  <script>
    const scrollBtn = document.getElementById("scrollTopBtn");
    window.onscroll = function () {
      scrollBtn.style.display = (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) ? "block" : "none";
    };
    scrollBtn.onclick = function () {
      window.scrollTo({ top: 0, behavior: "smooth" });
    };
  </script>

    <script>
    document.addEventListener("DOMContentLoaded", function () {
        let clickCount = 0;
        let clickTimer = null;

        document.body.addEventListener("click", function () {
            clickCount++;
            if (clickCount === 3) {
                document.getElementById("secret-login-btn").style.display = "block";
                clickCount = 0;
                clearTimeout(clickTimer);
            } else {
                clearTimeout(clickTimer);
                clickTimer = setTimeout(() => clickCount = 0, 500);
            }
        });

        const loginBtn = document.getElementById("secret-login-btn");
        if (loginBtn) {
            loginBtn.addEventListener("click", function () {
                window.location.href = "{{ url_for('auth.login') }}";
            });
        }

        // Вставим блок авторизации через шаблон
    });
    </script>

  <!-- Модальное переключение между статьями -->
  <script>
  document.addEventListener("DOMContentLoaded", function () {
      const modals = [...document.querySelectorAll(".modal")];

      document.querySelectorAll(".prev-modal").forEach(btn => {
          btn.addEventListener("click", () => {
              const currentId = parseInt(btn.dataset.currentId);
              const currentIndex = modals.findIndex(modal => modal.id === `articleModal${currentId}`);
              if (currentIndex > 0) {
                  const prevModal = new bootstrap.Modal(modals[currentIndex - 1]);
                  bootstrap.Modal.getInstance(modals[currentIndex]).hide();
                  prevModal.show();
              }
          });
      });

      document.querySelectorAll(".next-modal").forEach(btn => {
          btn.addEventListener("click", () => {
              const currentId = parseInt(btn.dataset.currentId);
              const currentIndex = modals.findIndex(modal => modal.id === `articleModal${currentId}`);
              if (currentIndex < modals.length - 1) {
                  const nextModal = new bootstrap.Modal(modals[currentIndex + 1]);
                  bootstrap.Modal.getInstance(modals[currentIndex]).hide();
                  nextModal.show();
              }
          });
      });
  });
  </script>

  {% block scripts %}{% endblock %}
</body>
</html>
